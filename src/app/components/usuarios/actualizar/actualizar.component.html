<p-toast key="tst"></p-toast>
<div *ngIf="isLoading" class="card">
    <div class="container">
        <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="8" fill="var(--surface-ground)"
            animationDuration=".5s"></p-progressSpinner>
    </div>
</div>
<div *ngIf="usuario && !isLoading" class="card">
	<div class="flex md:flex-row justify-content-between align-items-center">
		<div class="flex md:flex-row">
			<span class="icon-atras block">
				<p-button icon="pi pi-chevron-left" (click)="goBack()"
					styleClass="p-button-rounded p-button-secondary p-button-text"></p-button>
			</span>
			<h5 class="titulo">Usuario</h5>
		</div>
		<p-menu #menu [popup]="true" [model]="menuItems"></p-menu>
		<span class="block mt-2 p-input-icon-left">
			<p-button icon="pi pi-ellipsis-v" (click)="menu.toggle($event)"
				styleClass="p-button-rounded p-button-secondary p-button-text"></p-button>
		</span>
	</div>
	<div class="grid p-fluid mt-3">
		<div class="field col-12 md:col-6">
			<label>Nombre Completo</label>
			<input [(ngModel)]="usuario.nombreCompleto" pInputText type="text" [disabled]="bloqueado"
				[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.nombreCompleto)}" />
		</div>
		<div class="field col-12 md:col-6">
			<label>Correo electr√≥nico</label>
			<input [(ngModel)]="usuario.correo" pInputText type="text" [disabled]="bloqueado"
				[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.correo)}" />
		</div>
		<!--<div class="field col-12 md:col-6">
			<label>Direccion</label>
			<input [(ngModel)]="usuario.direccion" pInputText type="text" [disabled]="bloqueado"
				[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.direccion)}" />
		</div>-->
		<div class="field col-12 md:col-6">
			<label>Numero de DPI</label>
			<input [(ngModel)]="usuario.dpi" pInputText type="text" [disabled]="bloqueado"
				[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.dpi)}" />
		</div>
		<div class="field col-12 md:col-6">
			<label>Numero de Telefono</label>
			<input [(ngModel)]="usuario.telefono" pInputText type="text" [disabled]="bloqueado"
				[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.telefono)}" />
		</div>
		<div class="field col-12 md:col-6">
			<label [ngClass]="{'p-error block': isFieldInvalid(usuario.rol)}">Rol de Usuario</label>
			<p-dropdown #rolDropdown [(ngModel)]="usuario.rol" [options]="roles" [disabled]="bloqueado"
				optionLabel="titulo" (onChange)="onChangeRol($event)"></p-dropdown>
		</div>
		<div *ngIf="usuario.rol && usuario.rol.contieneTitulo" class="field col-12 md:col-6">
			<label htmlFor="tipo" [ngClass]="{'p-error block': isFieldInvalid(usuario.titulo)}">Titulo de Usuario</label>
			<p-dropdown #rolDropdown [(ngModel)]="usuario.titulo" [options]="titulos" [editable]="true" [disabled]="bloqueado"
				optionLabel="nombre"></p-dropdown>
		</div>
		<div *ngIf="usuario.rol && usuario.rol.contieneCarrera" class="field col-12 md:col-6">
			<label htmlFor="carreras" [ngClass]="{'p-error block': isFieldInvalid(usuario.carreras)}">Carreras</label>
			<p-multiSelect [(ngModel)]="usuario.carreras" inputId="multiselect" [options]="carreras" [disabled]="bloqueado" 
				optionLabel="nombre" [filter]="false"></p-multiSelect>
		</div>
		<div *ngIf="usuario.rol && usuario.rol.contieneRegistro" class="field col-12 md:col-6">
			<label htmlFor="registro">Registro Academico</label>
			<input [(ngModel)]="usuario.registroAcademico" pInputText id="registro" type="text" [disabled]="bloqueado"
			[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.registroAcademico)}"/>
		</div>
		<div *ngIf="usuario.rol && usuario.rol.contieneColegiado" class="field col-12 md:col-6">
			<label htmlFor="colegiado">Numero de Colegiado</label>
			<input [(ngModel)]="usuario.numeroColegiado" pInputText id="colegiado" type="text" [disabled]="bloqueado"
			[ngClass]="{'ng-invalid ng-dirty': isFieldInvalid(usuario.numeroColegiado)}"/>
		</div>
	</div>
	<div class="grid p-fluid mt-3">
		<div class="field col-12 md:col-6">
			<p-button *ngIf="!bloqueado" icon="pi pi-undo" styleClass="p-button-outlined" label="Cancelar"
				(click)="cancelarEdicion()" [loading]="isCanceling"></p-button>
		</div>
		<div class="field col-12 md:col-6">
			<p-button *ngIf="!bloqueado" icon="pi pi-save" styleClass="p-button-outlined" label="Guardar Cambios"
				(click)="guardarUsuario()" [loading]="isSaving"></p-button>
		</div>
		<div class="field col-12 md:col-12">
			<p-button *ngIf="bloqueado" icon="pi pi-user-edit" styleClass="p-button-outlined" label="Editar usuario"
				(click)="editar()"></p-button>
		</div>
	</div>
</div>
<p-confirmDialog header="Confirmacion" key="confirm1" icon="pi pi-exclamation-triangle" [style]="{width: '350px'}"
	acceptButtonStyleClass="p-button-text" rejectButtonStyleClass="p-button-text"></p-confirmDialog>
<style>
	.titulo {
		color: #00274e;
		font-weight: bold;
	}

	.icon-atras {
		margin-top: 10px;
	}
</style>